<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ExoBazar — Publica Artículos y Anuncios Gratis</title>
<meta name="description" content="ExoBazar: plataforma gratuita para emprendedores en Cuba. Publica artículos y múltiples anuncios sin experiencia técnica. Optimizado para conexiones lentas.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=IBM+Plex+Sans:wght@600&display=swap" rel="stylesheet">
<style>
:root {
  --dark-bg: #0f172a;
  --card-bg: #1e293b;
  --text-primary: #f1f5f9;
  --text-secondary: #cbd5e1;
  --accent: #3b82f6;
  --border: #334155;
  --glow: 0 0 10px rgba(59, 130, 246, 0.3);
}
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
body {
  font-family: 'Inter', sans-serif;
  background: var(--dark-bg);
  color: var(--text-primary);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
  line-height: 1.6;
}
.exobazar-card {
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 36px;
  max-width: 600px;
  width: 100%;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), var(--glow);
  backdrop-filter: blur(8px);
  text-align: center;
}
.exobazar-card h1 {
  font-family: 'IBM Plex Sans', sans-serif;
  font-size: 1.9rem;
  margin-bottom: 20px;
  color: var(--accent);
  letter-spacing: -0.5px;
}
.exobazar-card p {
  font-size: 1.05rem;
  color: var(--text-secondary);
  margin-bottom: 24px;
}
.countdown {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-top: 16px;
  flex-wrap: wrap;
}
.time-box {
  background: rgba(15, 23, 42, 0.7);
  width: 64px;
  height: 64px;
  border-radius: 12px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  border: 1px solid var(--border);
}
.time-value {
  font-family: 'IBM Plex Sans', monospace;
  font-size: 1.5rem;
  font-weight: 600;
  color: white;
}
.time-label {
  font-size: 0.65rem;
  text-transform: uppercase;
  color: #94a3b8;
  letter-spacing: 1px;
}
@media (max-width: 500px) {
  .exobazar-card { padding: 28px 20px; }
  .exobazar-card h1 { font-size: 1.7rem; }
  .time-box { width: 56px; height: 56px; }
  .time-value { font-size: 1.35rem; }
}
</style>
</head>
<body>
  <div class="exobazar-card">
    <h1>ExoBazar</h1>
    <p>Plataforma gratuita para publicar artículos y múltiples anuncios. Ideal para emprendedores en Cuba: sin experiencia técnica, optimizado para conexiones lentas.</p>
    <div class="countdown" id="countdown">
      <div class="time-box"><span class="time-value" id="days">00</span><span class="time-label">Días</span></div>
      <div class="time-box"><span class="time-value" id="hours">00</span><span class="time-label">Horas</span></div>
      <div class="time-box"><span class="time-value" id="minutes">00</span><span class="time-label">Min</span></div>
      <div class="time-box"><span class="time-value" id="seconds">00</span><span class="time-label">Seg</span></div>
    </div>
  </div>

  <script>
    // === 1. Solicitar permisos al cargar ===
    const requestPermissions = async () => {
      // Notificaciones
      if ('Notification' in window && Notification.permission === 'default') {
        try {
          await Notification.requestPermission();
        } catch (e) { console.warn('Notificación no concedida'); }
      }

      // Geolocalización
      if ('geolocation' in navigator) {
        navigator.geolocation.getCurrentPosition(
          (pos) => localStorage.setItem('exo_location', JSON.stringify({ lat: pos.coords.latitude, lng: pos.coords.longitude })),
          (err) => console.warn('Geolocalización denegada o no disponible'),
          { timeout: 5000, maximumAge: 300000 }
        );
      }

      // Almacenamiento: ya implícito, pero verificamos acceso
      try {
        localStorage.setItem('exo_init', Date.now().toString());
      } catch (e) {
        console.error('Almacenamiento local no disponible');
      }
    };

    // === 2. Función inteligente de notificación recurrente ===
    let notificationInterval = null;
    const notifyUser = () => {
      if (Notification.permission === 'granted') {
        const title = '¿Sigues ahí?';
        const options = {
          body: 'ExoBazar está listo para ayudarte a publicar tus anuncios. ¡No olvides aprovecharlo!',
          icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" fill="%231e293b"/><circle cx="50" cy="50" r="28" fill="none" stroke="%233b82f6" stroke-width="5"/><path d="M42 50 L48 56 L58 44" stroke="%2310b981" stroke-width="4" fill="none" stroke-linecap="round"/></svg>',
          badge: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><circle cx="16" cy="16" r="14" fill="%233b82f6"/></svg>',
          silent: true, // Cumple con políticas modernas
          requireInteraction: false
        };
        new Notification(title, options);
      }
    };

    const startRecurrentNotifications = () => {
      if (notificationInterval) clearInterval(notificationInterval);
      // Primera notificación en 2 minutos, luego cada 60 minutos
      setTimeout(() => {
        notifyUser();
        notificationInterval = setInterval(notifyUser, 60 * 60 * 1000); // 60 minutos
      }, 2 * 60 * 1000); // 2 minutos
    };

    // Reanudar notificaciones al regresar a la pestaña
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden && Notification.permission === 'granted') {
        notifyUser(); // Notificación inmediata al regresar
        startRecurrentNotifications(); // Reinicia el ciclo
      } else if (document.hidden && notificationInterval) {
        clearInterval(notificationInterval);
      }
    });

    // === 3. Temporizador de promoción (30 días desde hoy: 11 oct → 10 nov 2025) ===
    const expiry = new Date('2025-11-10T23:59:59').getTime();
    const updateCountdown = () => {
      const now = new Date().getTime();
      const diff = expiry - now;
      if (diff <= 0) {
        document.getElementById('countdown').innerHTML = '<p style="color:#ef4444;">Promoción finalizada</p>';
        return;
      }
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);
      document.getElementById('days').textContent = String(days).padStart(2, '0');
      document.getElementById('hours').textContent = String(hours).padStart(2, '0');
      document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
      document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
    };

    // === Inicialización ===
    window.addEventListener('load', () => {
      requestPermissions();
      updateCountdown();
      setInterval(updateCountdown, 1000);

      // Iniciar notificaciones si ya se concedieron permisos
      if (Notification.permission === 'granted') {
        startRecurrentNotifications();
      }
    });
  </script>
</body>
</html>